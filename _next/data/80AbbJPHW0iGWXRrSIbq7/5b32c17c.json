{"pageProps":{"post":{"title":"ダイクストラ法","slug":"5b32c17c","content":"<h2>解説/アルゴリズム</h2>\n<p><img src=\"./static/images/5b32c17c/1.png\" alt=\"\"></p>\n<p>辺に重みが付いているグラフのことを重み付きグラフと呼び、上記のような形となる。</p>\n<p>重みは頂点間の移動距離や時間を表しており、上記の ABCD の各頂点は駅名、辺の数字は駅間の移動時間だと考えてみる。</p>\n<p>たとえば A 駅から D 駅までを最短の時間で移動したい場合、A 駅から D 駅へと直接移動すると 20 分かかるが、A 駅-&gt;B 駅-&gt;C 駅-&gt;D 駅と移動すると 18 分で済む。</p>\n<p>このように重み付きグラフの場合、移動する頂点の数が短かければ最短経路になるとは限らない。</p>\n<p>これから説明するダイクストラ法は重み付きグラフにおいて最短経路を求めるアルゴリズムとなる。</p>\n<p>ただし辺の重みに負数が含まれる場合はダイクストラ法を利用することはできない。</p>\n<p><img src=\"./static/images/5b32c17c/2.png\" alt=\"\"></p>\n<p>新たに重み付きグラフを用意して、頂点 A が開始地点だとする。</p>\n<p><img src=\"./static/images/5b32c17c/3.png\" alt=\"\"></p>\n<p>A から開始をしているので、当然ながら A までの最短距離は 0 になる。</p>\n<p>画像ではわかりやすいように、確定した頂点の付近にその頂点までの最短距離を書き、頂点の色を赤に変更している。</p>\n<ul>\n<li>確定頂点: [A]</li>\n<li>A までの最短距離: 0 / ルート: [A] (確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/4.png\" alt=\"\"></p>\n<p>最短経路が確定した A に繋がっている頂点に A からの距離を書き加えておく。</p>\n<p>（A-B / A-F / A-E 間の距離を、各頂点に保持しておく。）</p>\n<p>A に繋がっているこれらの頂点は次に最短経路が確定するかもしれない未確定頂点。</p>\n<p>画像ではわかりやすいように、未確定頂点の色とルートを青色に変更している。</p>\n<ul>\n<li>未確定頂点: [B, F, E]</li>\n<li>確定頂点: [A]</li>\n<li>A までの最短距離: 0 / ルート: [A] (確定)</li>\n<li>B までの最短距離: 9 / ルート: [A-B] (未確定)</li>\n<li>F までの最短距離: 4 / ルート: [A-F] (未確定)</li>\n<li>E までの最短距離: 3 / ルート: [A-E] (未確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/5.png\" alt=\"\"></p>\n<p>開始地点から一番短い経路で繋がっている未確定頂点を探す。</p>\n<p>A-B / A-F / A-E の中では、A-E 間の距離が一番短いので、E まで移動するには、A-E 間が最短であることが確定する。</p>\n<p>何故かというと最短経路が確定している A に繋がっている頂点の中で、一番短い経路が A-E なので、他の経路、たとえば A-F や A-B から E の方に周りこんだルートが A-E より小さくなることはありえないから。</p>\n<ul>\n<li>未確定頂点: [B, F]</li>\n<li>確定頂点: [A, E]</li>\n<li>A までの最短距離: 0 [A] (確定)</li>\n<li>B までの最短距離: 9 [A-B] (未確定)</li>\n<li>F までの最短距離: 4 [A-F] (未確定)</li>\n<li>E までの最短距離: 3 [A-E] (確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/6.png\" alt=\"\"></p>\n<p>最短経路が確定した E に繋がっている頂点である D と F に注目する。</p>\n<p>D は新しく繋がった未確定頂点。</p>\n<p>それに加え、E には 3 という開始地点からの距離が保持されているが、それに E-D 間の距離を足した 8 を D に書き込んでおく。</p>\n<p>つまり、まだ未確定だが、開始地点からの最短距離を暫定的に頂点に書き込んでおく。</p>\n<p>F はすでに候補になっている頂点なので、開始地点から F までの暫定的な最短距離 4 が書き込まれている。</p>\n<p>それがさらに短くできるならば更新を行う。</p>\n<p>A-E-F の距離は 5 だが、もともと存在していた A-F の経路の方が短いので、F までの暫定的な最短距離の情報は更新をしない。</p>\n<p>今のところ、未確定だが F までの最短経路は A-F のままとなる。</p>\n<ul>\n<li>未確定頂点: [B, D, F]</li>\n<li>確定頂点: [A, E]</li>\n<li>A までの最短距離: 0 [A] (確定)</li>\n<li>B までの最短距離: 9 [A-B] (未確定)</li>\n<li>D までの最短距離: 8 [A-E-D] (未確定)</li>\n<li>F までの最短距離: 4 [A-F] (未確定)</li>\n<li>E までの最短距離: 3 [A-E] (確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/7.png\" alt=\"\"></p>\n<p>開始地点から一番短い経路で繋がっている未確定頂点を探す。</p>\n<p>A-B / A-F / A-E-D の中では、A-F 間の距離が一番短いので、F まで移動するには、A-F 間が最短であることが確定する。</p>\n<ul>\n<li>未確定頂点: [B, D]</li>\n<li>確定頂点: [A, E, F]</li>\n<li>A までの最短距離: 0 [A] (確定)</li>\n<li>B までの最短距離: 9 [A-B] (未確定)</li>\n<li>D までの最短距離: 8 [A-E-D] (未確定)</li>\n<li>F までの最短距離: 4 [A-F] (確定)</li>\n<li>E までの最短距離: 3 [A-E] (確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/8.png\" alt=\"\"></p>\n<p>最短経路が確定した F に繋がっている頂点である B と D に注目する。</p>\n<p>B と D に書き込まれている最短距離より、A-F から通る距離の方が短ければ、情報を更新する。</p>\n<p>B の場合、A-B の距離 9 より A-F-B の距離 7 の方が短いので、B 頂点までの最短経路が 7 に更新される。</p>\n<p>D の場合、A-E-D の距離 8 より A-F-D の距離 9 の方が長いので、D 頂点までの最短経路は 8 のままになる。</p>\n<ul>\n<li>未確定頂点: [B, D]</li>\n<li>確定頂点: [A, E, F]</li>\n<li>A までの最短距離: 0 [A] (確定)</li>\n<li>B までの最短距離: 7 [A-F-B] (未確定)</li>\n<li>D までの最短距離: 8 [A-E-D] (未確定)</li>\n<li>F までの最短距離: 4 [A-F] (確定)</li>\n<li>E までの最短距離: 3 [A-E] (確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/9.png\" alt=\"\"></p>\n<p>開始地点から一番短い経路で繋がっている未確定頂点を探す。</p>\n<p>A-B / A-E-D の中では、A-B 間の距離が一番短いので、B まで移動するには、A-B 間が最短であることが確定する。</p>\n<ul>\n<li>未確定頂点: [D]</li>\n<li>確定頂点: [A, B, E, F]</li>\n<li>A までの最短距離: 0 [A] (確定)</li>\n<li>B までの最短距離: 7 [A-F-B] (確定)</li>\n<li>D までの最短距離: 8 [A-E-D] (未確定)</li>\n<li>F までの最短距離: 4 [A-F] (確定)</li>\n<li>E までの最短距離: 3 [A-E] (確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/10.png\" alt=\"\"></p>\n<p>最短経路が確定した B に繋がっている頂点である C に注目する。</p>\n<p>C は新しく繋がった未確定頂点。</p>\n<p>B までの最短距離 7 に B-C 間の距離を足した 11 を C に書き込んでおく。</p>\n<ul>\n<li>未確定頂点: [C, D]</li>\n<li>確定頂点: [A, B, E, F]</li>\n<li>A までの最短距離: 0 [A] (確定)</li>\n<li>B までの最短距離: 7 [A-F-B] (確定)</li>\n<li>C までの最短距離: 11 [A-F-B-C] (未確定)</li>\n<li>D までの最短距離: 8 [A-E-D] (未確定)</li>\n<li>F までの最短距離: 4 [A-F] (確定)</li>\n<li>E までの最短距離: 3 [A-E] (確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/11.png\" alt=\"\"></p>\n<p>開始地点から一番短い経路で繋がっている未確定頂点を探す。</p>\n<p>A-F-B-C / A-E-D の中では、A-E-D 間の距離が一番短いので、D まで移動するには、A-E-D 間が最短であることが確定する。</p>\n<ul>\n<li>未確定頂点: [C]</li>\n<li>確定頂点: [A, B, D, E, F]</li>\n<li>A までの最短距離: 0 [A] (確定)</li>\n<li>B までの最短距離: 7 [A-F-B] (確定)</li>\n<li>C までの最短距離: 11 [A-F-B-C] (未確定)</li>\n<li>D までの最短距離: 8 [A-E-D] (確定)</li>\n<li>F までの最短距離: 4 [A-F] (確定)</li>\n<li>E までの最短距離: 3 [A-E] (確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/12.png\" alt=\"\"></p>\n<p>最短経路が確定した D に繋がっている頂点である C に注目する。</p>\n<p>C に書き込まれている最短距離より、A-E-D から通る距離の方が短ければ、情報を更新する。</p>\n<p>C の場合、A-F-B-C の距離 11 より A-E-D-C の距離 10 の方が短いので、C 頂点までの最短経路が 10 に更新される。</p>\n<ul>\n<li>未確定頂点: [C]</li>\n<li>確定頂点: [A, B, D, E, F]</li>\n<li>A までの最短距離: 0 [A] (確定)</li>\n<li>B までの最短距離: 7 [A-F-B] (確定)</li>\n<li>C までの最短距離: 10 [A-E-D-C] (未確定)</li>\n<li>D までの最短距離: 8 [A-E-D] (確定)</li>\n<li>F までの最短距離: 4 [A-F] (確定)</li>\n<li>E までの最短距離: 3 [A-E] (確定)</li>\n</ul>\n<p><img src=\"./static/images/5b32c17c/13.png\" alt=\"\"></p>\n<p>開始地点から一番短い経路で繋がっている未確定頂点を探す。\n未確定頂点は C しか残っていないので、C まで移動するには、A-E-D-C 間が最短であることが確定する。</p>\n<ul>\n<li>未確定頂点: []</li>\n<li>確定頂点: [A, B, C, D, E, F]</li>\n<li>A までの最短距離: 0 [A] (確定)</li>\n<li>B までの最短距離: 7 [A-F-B] (確定)</li>\n<li>C までの最短距離: 10 [A-E-D-C] (確定)</li>\n<li>D までの最短距離: 8 [A-E-D] (確定)</li>\n<li>F までの最短距離: 4 [A-F] (確定)</li>\n<li>E までの最短距離: 3 [A-E] (確定)</li>\n</ul>\n<h2>コード例</h2>\n<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;bits/stdc++.h></span></span>\n\n<span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> std<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> ll <span class=\"token operator\">=</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> P <span class=\"token operator\">=</span> pair<span class=\"token operator\">&lt;</span>ll<span class=\"token punctuation\">,</span> ll<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">Edge</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> to<span class=\"token punctuation\">;</span>\n  ll cost<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 頂点数</span>\n  <span class=\"token keyword\">int</span> s <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 始点</span>\n\n  vector<span class=\"token operator\">&lt;</span>vector<span class=\"token operator\">&lt;</span>Edge<span class=\"token operator\">>></span> <span class=\"token function\">edge</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 辺の登録。例えば一番上は頂点0から頂点1まで移動するのにコストが1かかることを表している</span>\n  edge<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  edge<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  edge<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  edge<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  edge<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 始点から各頂点までの移動総コスト</span>\n  <span class=\"token comment\">// 始点は0、それ以外の頂点は入ることがあり得ない大きい値にしておく</span>\n  <span class=\"token keyword\">int</span> INF <span class=\"token operator\">=</span> <span class=\"token number\">1000000000</span><span class=\"token punctuation\">;</span>\n  vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span> <span class=\"token function\">dist</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> INF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  dist<span class=\"token punctuation\">[</span>s<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 未確定の頂点の中から始点からの移動総コストが最小のものを高速に取り出すため、</span>\n  <span class=\"token comment\">// 優先度付きキューを利用する</span>\n  <span class=\"token comment\">// pair{頂点までの暫定コスト, 頂点}</span>\n  priority_queue<span class=\"token operator\">&lt;</span>P<span class=\"token punctuation\">,</span> vector<span class=\"token operator\">&lt;</span>P<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> greater<span class=\"token operator\">&lt;</span>P<span class=\"token operator\">>></span> pq<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 始点と始点までのコスト0を入れておく</span>\n  pq<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 優先度付きキューが空になるまでループ</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>pq<span class=\"token punctuation\">.</span><span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 未確定の頂点の中から始点からの移動総コストが最小のものを取り出す</span>\n    <span class=\"token comment\">// この時点で、始点から取り出した頂点までの最短コストが確定する</span>\n    P p <span class=\"token operator\">=</span> pq<span class=\"token punctuation\">.</span><span class=\"token function\">top</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    pq<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 具体的な名前に変更</span>\n    ll cost <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> cur <span class=\"token operator\">=</span> p<span class=\"token punctuation\">.</span>second<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 既にcostより小さい値で確定されているのでスキップ</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dist<span class=\"token punctuation\">[</span>cur<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span> cost<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 頂点に繋がっている各頂点を走査</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> e <span class=\"token operator\">:</span> edge<span class=\"token punctuation\">[</span>cur<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 計算したコストが暫定コストより小さければ更新。</span>\n      <span class=\"token comment\">// 次の頂点を優先度付きキューに追加する</span>\n      ll new_cost <span class=\"token operator\">=</span> dist<span class=\"token punctuation\">[</span>cur<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span>cost<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>new_cost <span class=\"token operator\">&lt;</span> dist<span class=\"token punctuation\">[</span>e<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        dist<span class=\"token punctuation\">[</span>e<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> new_cost<span class=\"token punctuation\">;</span>\n        pq<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>new_cost<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> x <span class=\"token operator\">:</span> dist<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    cout <span class=\"token operator\">&lt;&lt;</span> x <span class=\"token operator\">&lt;&lt;</span> endl<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>キューの仕様上、同じ頂点を追加した際、別々なものとして扱うので、確定した頂点なのにまたキューからその頂点が出てくるということがある。</p>\n<p>その場合、無駄な走査を行わないように、 <code>if (dist[cur] &lt; cost)</code> ならスキップを行うという処理を入れるのがポイントとなる。</p>\n<h2>計算量</h2>\n<p>優先度付きキュー（ヒープ）を用いる場合、計算量は <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi mathvariant=\"normal\">∣</mi><mi>E</mi><mi mathvariant=\"normal\">∣</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi mathvariant=\"normal\">∣</mi><mi>V</mi><mi mathvariant=\"normal\">∣</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(|E|log|V|)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mord\">∣</span><span class=\"mclose\">)</span></span></span></span> になる。</p>\n"}},"__N_SSG":true}