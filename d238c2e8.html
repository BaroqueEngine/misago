<!DOCTYPE html><html lang="ja"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="グラフィックスプログラミング関連技術についての覚え書き"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.3/dist/katex.min.css" integrity="sha384-ThssJ7YtjywV52Gj4JE/1SQEDoMEckXyhkFVwaf4nDSm5OBlXeedVYjuuUd0Yua+" crossorigin="anonymous"/><title>gl_FragCoordの正規化 | みさご解体新書</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/31a6f04d7f80e58df808.css" as="style"/><link rel="stylesheet" href="/_next/static/css/31a6f04d7f80e58df808.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c7330c076417ef7d2bd3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c7330c076417ef7d2bd3.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-715970c8028b8d8e1f64.js" defer=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/_next/static/chunks/main-8f141fd03012b99227c0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-39db53daf4158fa5d34d.js" defer=""></script><script src="/_next/static/chunks/996-9333713592b33abcda8c.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-4c0b6207feb9465a8097.js" defer=""></script><script src="/_next/static/eeIIWg2pKu8sOXtFr3U-y/_buildManifest.js" defer=""></script><script src="/_next/static/eeIIWg2pKu8sOXtFr3U-y/_ssgManifest.js" defer=""></script></head><body class="bg-bg-color"><div id="__next"><div class="min-h-screen bg-bg-color text-white"><main><div class="container mx-auto max-w-full"><h2 class="bg-gray-700 font-index text-lg text-gray-300 py-7 px-7"><a href="/">みさご解体新書</a></h2><article class="px-8 py-20"><h1 class="font-index text-3xl font-bold mb-16 text-center">gl_FragCoordの正規化</h1><div class="max-w-4xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><h2>解説/アルゴリズム</h2>
<pre class="language-glsl"><code class="language-glsl"><span class="token keyword">vec2</span> uv <span class="token operator">=</span> <span class="token punctuation">(</span>gl_FragCoord<span class="token punctuation">.</span>xy <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">-</span> vResolution<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">min</span><span class="token punctuation">(</span>vResolution<span class="token punctuation">.</span>x<span class="token punctuation">,</span> vResolution<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>gl_FragCoord はよくこの形で正規化されることが多いのですが、なぜこうなるかを解説します。</p>
<p>gl_FragCoord は Canvas のピクセル座標が格納されています。<br>
ただし、y 座標は上に行くほど大きくなるので、左下が (0, 0) 、右上が (キャンバスの幅, キャンバスの高さ) になります。</p>
<p>この gl_FragCoord を クリップ空間と同じの -1.0 ～ 1.0 の範囲に正規化するのが目的です。</p>
<p>まずは Canvas の縦横が同じサイズだった場合について考えてみます。</p>
<pre class="language-glsl"><code class="language-glsl"><span class="token keyword">vec2</span> uv <span class="token operator">=</span> gl_FragCoord<span class="token punctuation">.</span>xy <span class="token operator">/</span> vResolution <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
</code></pre>
<p>gl_FragCoord を Canvas のサイズで割ることで 0.0 ～ 1.0 の範囲に変換します。<br>
この範囲を 2 倍することで、0.0 ～ 2.0 の範囲に変換します。<br>
更にこの範囲から -1.0 を引くことで、 -1.0 ～ 1.0 の範囲に変換することができました。</p>
<p>次は Canvas の縦横が異なるサイズだった場合について考えてみます。</p>
<pre class="language-glsl"><code class="language-glsl"><span class="token keyword">vec2</span> uv <span class="token operator">=</span> gl_FragCoord<span class="token punctuation">.</span>xy <span class="token operator">/</span> vResolution<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
</code></pre>
<p>縦横のサイズが異なる場合で縦横比を維持したい場合は、Canvas の幅か高さどちらか一方で割らなければなりません。</p>
<p>今回は高さで割ることにします。</p>
<pre class="language-glsl"><code class="language-glsl"><span class="token keyword">vec2</span> uv <span class="token operator">=</span> gl_FragCoord<span class="token punctuation">.</span>xy <span class="token operator">/</span> vResolution<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">-</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span>vResolution<span class="token punctuation">.</span>x <span class="token operator">/</span> vResolution<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>vResolution.y で割って正規化する場合、縦のサイズは 1 ですが、横は vResolution.x / vResolution.y です。
ですので、 <code>-1.0</code> の部分を、<code>vec2(vResolution.x / vResolution.y, 1.0)</code> にする必要があります。</p>
<p>各項の vResolution.y で割るところを括りだすと、</p>
<pre class="language-glsl"><code class="language-glsl"><span class="token keyword">vec2</span> uv <span class="token operator">=</span> <span class="token punctuation">(</span>gl_FragCoord<span class="token punctuation">.</span>xy <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">-</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span>vResolution<span class="token punctuation">.</span>x<span class="token punctuation">,</span> vResolution<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> vResolution<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
</code></pre>
<p>となり、 <code>vec2(vResolution.x, vResolution.y)</code> はただの vResolution のことなので、</p>
<pre class="language-glsl"><code class="language-glsl"><span class="token keyword">vec2</span> uv <span class="token operator">=</span> <span class="token punctuation">(</span>gl_FragCoord<span class="token punctuation">.</span>xy <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">-</span> vResolution<span class="token punctuation">)</span> <span class="token operator">/</span> vResolution<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
</code></pre>
<p>と書くことができます。</p>
</div></div></article></div></main></div><footer class="bg-gray-700 text-gray-300"><div class="container mx-auto max-w-full"><div class="py-12 flex flex-col items-center"><h3 class="text-base text-center">miku / BAROQUE ENGINE</h3></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"gl_FragCoordの正規化","slug":"d238c2e8","content":"\u003ch2\u003e解説/アルゴリズム\u003c/h2\u003e\n\u003cpre class=\"language-glsl\"\u003e\u003ccode class=\"language-glsl\"\u003e\u003cspan class=\"token keyword\"\u003evec2\u003c/span\u003e uv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egl_FragCoord\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exy \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2.0\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e vResolution\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token function\"\u003emin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e vResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ey\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003egl_FragCoord はよくこの形で正規化されることが多いのですが、なぜこうなるかを解説します。\u003c/p\u003e\n\u003cp\u003egl_FragCoord は Canvas のピクセル座標が格納されています。\u003cbr\u003e\nただし、y 座標は上に行くほど大きくなるので、左下が (0, 0) 、右上が (キャンバスの幅, キャンバスの高さ) になります。\u003c/p\u003e\n\u003cp\u003eこの gl_FragCoord を クリップ空間と同じの -1.0 ～ 1.0 の範囲に正規化するのが目的です。\u003c/p\u003e\n\u003cp\u003eまずは Canvas の縦横が同じサイズだった場合について考えてみます。\u003c/p\u003e\n\u003cpre class=\"language-glsl\"\u003e\u003ccode class=\"language-glsl\"\u003e\u003cspan class=\"token keyword\"\u003evec2\u003c/span\u003e uv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e gl_FragCoord\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exy \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e vResolution \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2.0\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003egl_FragCoord を Canvas のサイズで割ることで 0.0 ～ 1.0 の範囲に変換します。\u003cbr\u003e\nこの範囲を 2 倍することで、0.0 ～ 2.0 の範囲に変換します。\u003cbr\u003e\n更にこの範囲から -1.0 を引くことで、 -1.0 ～ 1.0 の範囲に変換することができました。\u003c/p\u003e\n\u003cp\u003e次は Canvas の縦横が異なるサイズだった場合について考えてみます。\u003c/p\u003e\n\u003cpre class=\"language-glsl\"\u003e\u003ccode class=\"language-glsl\"\u003e\u003cspan class=\"token keyword\"\u003evec2\u003c/span\u003e uv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e gl_FragCoord\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exy \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e vResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ey\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e縦横のサイズが異なる場合で縦横比を維持したい場合は、Canvas の幅か高さどちらか一方で割らなければなりません。\u003c/p\u003e\n\u003cp\u003e今回は高さで割ることにします。\u003c/p\u003e\n\u003cpre class=\"language-glsl\"\u003e\u003ccode class=\"language-glsl\"\u003e\u003cspan class=\"token keyword\"\u003evec2\u003c/span\u003e uv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e gl_FragCoord\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exy \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e vResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ey \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2.0\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evec2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e vResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ey\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003evResolution.y で割って正規化する場合、縦のサイズは 1 ですが、横は vResolution.x / vResolution.y です。\nですので、 \u003ccode\u003e-1.0\u003c/code\u003e の部分を、\u003ccode\u003evec2(vResolution.x / vResolution.y, 1.0)\u003c/code\u003e にする必要があります。\u003c/p\u003e\n\u003cp\u003e各項の vResolution.y で割るところを括りだすと、\u003c/p\u003e\n\u003cpre class=\"language-glsl\"\u003e\u003ccode class=\"language-glsl\"\u003e\u003cspan class=\"token keyword\"\u003evec2\u003c/span\u003e uv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egl_FragCoord\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exy \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2.0\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evec2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e vResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ey\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e vResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ey\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eとなり、 \u003ccode\u003evec2(vResolution.x, vResolution.y)\u003c/code\u003e はただの vResolution のことなので、\u003c/p\u003e\n\u003cpre class=\"language-glsl\"\u003e\u003ccode class=\"language-glsl\"\u003e\u003cspan class=\"token keyword\"\u003evec2\u003c/span\u003e uv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egl_FragCoord\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exy \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2.0\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e vResolution\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e vResolution\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ey\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eと書くことができます。\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/[slug]","query":{"slug":"d238c2e8"},"buildId":"eeIIWg2pKu8sOXtFr3U-y","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>